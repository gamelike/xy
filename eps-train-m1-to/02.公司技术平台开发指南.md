---
title: 公司技术平台开发指南
---

# 目录

* [简介](#公司技术平台开发指南)
* [入门指南](#环境搭建)
    * [项目初始化指南](#项目初始化指南)
    * [功能开发培训视频](#功能开发培训视频)
    * [组件使用培训视频](#组件使用培训视频)
    * [样例工程编写指南](#样例工程编写指南)
* [组件](#组件)
    * [布局组件](#布局组件)
        * [html](#html)
        * [html_head](#html_head)
        * [html_body](#html_body)
        * [nav](#nav)
        * [container](#container)
        * [page_head](#page_head)
        * [page_head_more](#page_head_more)
        * [page_content](#page_content)
        * [content_title](#content_title)
        * [content_body](#content_body)
        * [content_submit](#content_submit)
        * [page_footer](#page_footer)
        * [foot_script](#foot_script)
        
    * [通用组件](#通用组件)
        * [script](#script)
        * [scriptCurrent](#scriptCurrent)
        * [css](#css)
        * [cssCurrent](#cssCurrent)
        
    * [表单组件](#表单组件)
        * [form](#form)
        * [searchButton](#searchButton)
        * [text](#text)
        * [textarea](#textarea)
        * [radio](#radio)
        * [checkbox](#checkbox)
        * [checkboxsingle](#checkboxsingle)
        * [select](#select)
        * [calendar](#calendar)
        * [button](#button)
        * [a](#a)
        * [button_more](#button_more)
        * [button_group](#button_group)
        * [search_group](#search_group)
        * [switch](#switch)
        * [ckeditor](#ckeditor)
        * [code](#code)
        * [mulcode](#mulcode)
        * [input_suggest](#input_suggest)
        * [customComponent](#customComponent)
        * [upload](#upload)
        * [download](#download)
        * [extended_field](#extended_field)
        * [extended_validate_elements](#extended_validate_elements)
        
    * [展示组件](#展示组件)
      
        * [splittoolbar](#splittoolbar)
        
        * [insert](#insert)
        
        * [index](#index)
        
    * [扩展组件](#扩展组件)
        *  [pageoffice](#pageoffice)
        *  [PO_Words2Pdfs](#PO_Words2Pdfs)
* [后台服务](#后台服务)
    * [控制器](#控制器)
        * [QueryVo](#QueryVo)
        * [ReturnValue](#ReturnValue)
        * [BaseController](#BaseController)
        * [Visit](#Visit)
        * [XinyuanDefaultSplitPageInfo](#XinyuanDefaultSplitPageInfo)
        * [ValidationUtil](#ValidationUtil)
    * [服务](#服务)
        * [BaseService](#BaseService)
    * [数据库访问](#数据库访问)
        * [BaseDao](#BaseDao)
    * [工具类](#工具类)
        * [TreeOp](#TreeOp)
        * [ZxtxxUtil](#ZxtxxUtil)
    * [远程调用](#远程调用)
        * [概述](#概述)
        * [CodeHelper](#CodeHelper)
        * [XtglHelper](#XtglHelper)
        * [ZzqxHelper](#ZzqxHelper)
        * [WorkFlowHelper](#WorkFlowHelper)
* [javascript方法](#javascript方法)
    * [页面提交](#页面提交)
        * [forward](#forward)
        * [openWindow](#openWindow)
        * [hold](#hold)
        * [ajaxdefault](#ajaxdefault)
        * [refresh](#refresh)
    * [弹出窗口](#弹出窗口)
        * [popup](#popup)
        * [popupNomal](#popupNomal)
        * [popupSmall](#popupSmall)
        * [popupOk](#popupOk)
        * [verify](#verify)
    * [返回](#返回)
        * [back](#back)
* [校验框架](#校验框架)
    * [前台校验框架](#前台校验框架)
    * [后台校验框架](#后台校验框架)
* [树形结构设计及操作](#树形结构设计及操作)
* [数据权限体系实现](#数据权限体系实现)
* [插件体系实现](#插件体系实现)
* [重复提交](#重复提交)
* [crsf](#crsf)
* [参数防篡改](#参数防篡改)





# 公司技术平台开发指南





# 环境搭建



## 项目初始化指南
-------




### 操作步骤

1.打开idea，在菜单中依次点击**File-New-Project From Vesion** Contral-Subversion，如图所示：
![新建project](/images/Developer's Guide/hj/drgc/1.png)    

2.输入或选择你需要的svn路径，然后找到对应的工程根目录，点击**check out**，如图所示：
![选择project](/images/Developer's Guide/hj/drgc/3.png) 
然后根据提示一步一步进行，在此不再赘述。

3.在新工程下载到本地后，点击**File-Settings**,如图所示：
![打开设置界面](/images/Developer's Guide/hj/drgc/5.png) 

4.在弹出的设置界面中，左上角输入关键字**maven**，查询结果如图所示：
![设置界面](/images/Developer's Guide/hj/drgc/7.png) 

5.从[这里](/images/Developer's Guide/hj/drgc/settings.xml)点击鼠标右键，选择目标另存为，下载settings.xml文件，保存至本机某个目录，并指定**User setting file**为对应下载好的文件。如图所示：
![设置settings](/images/Developer's Guide/hj/drgc/9.png) 

6.点击下方的**Importing**关键字，勾选右侧的**Importing Maven projects automatically**，如下图所示：
![设置autoimport](/images/Developer's Guide/hj/drgc/11.png) 

7.设置完成后，点击idea右侧**Maven Project选项卡**，点击**刷新按钮**，如下图所示：
![刷新maven](/images/Developer's Guide/hj/drgc/13.png) 

7.刷新之后，如下图所示：
![maven私有库设置](/images/Developer's Guide/hj/drgc/15.png) 
- 在**Profiles**选项卡中选择**development**
- 在右下角弹出的提示框中选择**Enable Auto-Import**

8.打开本机hosts文件，加入`193.193.193.188 mvn.xinyuan.com.cn`这一行映射。

9.点击idea上方配置服务器的地方，开始配置服务器，如下图所示：
![配置服务器](/images/Developer's Guide/hj/drgc/17.png) 

10.点击idea上方配置服务器的地方，开始配置服务器，如下图所示：
![新建tomcat](/images/Developer's Guide/hj/drgc/19.png) 

10.点击Deployment选项卡，点击加号，选择Artifact，如下图所示：
![新建tomcat](/images/Developer's Guide/hj/drgc/21.png) 

11.在弹出的页面中选择:war exploded，选择之后根据自己需要输入上下文根，如下图所示：
![新建tomcat](/images/Developer's Guide/hj/drgc/23.png) 

12.回到**Server**选项卡，如果没有配置tomcat服务器，在**Application Server**后面点击**Configure**增加tomcat服务器，在此不再赘述。

13.回到**Server**选项卡，**VM Options**中可选参数为：
```
-Dfile.encoding=UTF-8
-Xms800m
-Xmx800m
-XX:MaxNewSize=256m
-javaagent:C:/springloaded-1.2.5.RELEASE.jar
-noverify
```
- 根据自己需要调整以上参数
- 此处用到了springloaded技术，可以在更新类之后不用重启服务器生效，从[这里](/images/Developer's Guide/hj/drgc/springloaded-1.2.5.RELEASE.jar)点击鼠标右键，选择目标另存为，下载springloaded的jar包。

14.回到**Server**选项卡，其中**On frame deactivation**参数表示当你从idea切换到其他应用时（例如浏览器），idea所做的操作，如果我们选择**Update classes and resources**参数，配合spirngloaded即可实现大部分情况下的热更新，但这里要注意的是，热部署会导致断点失效。
![更新方式](/images/Developer's Guide/hj/drgc/25.png) 

14.配置完成之后，可启动tomcat，如果成功打开弹出窗口，表示整个配置完成。



## 功能开发培训视频
-----------------------
[功能开发培训视频](images\Developer's Guide\hj\gnkf\功能开发培训视频.zip)，请用右键另存为。



## 组件使用培训视频
------

[组件使用培训视频](images\Developer's Guide\hj\zjsy\组件使用培训视频.zip)，请用右键另存为。



## 样例工程编写指南



# 组件



## 布局组件





### html
------

#### 描述

页面根属性，相当于页面的html标签

#### 属性说明

- type : 定义页面类型,当为popup时为弹出页面
- style ： 规定元素的行内样式

#### 样例

```html
<@xy.html>内容</@xy.html>
```





### html_head

------

#### 描述
html中<head>部分。

#### 属性说明
 - value : 页面标题。
 - type : 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.html_head value="参数配置">
    <@xy.css href="master.css"/><!—自定义的css-->
</@xy.html_head>
```





### html_body

------

#### 描述
html中body部分
#### 属性说明
 - type : 定义页面类型,当为popup时为弹出页面
 - class : 定义了元素的类名
 - style : 规定元素的行内样式

#### 样例
```html
<@xy.html_body>
内容
</@xy.html_body>
```





###nav

------

#### 描述
页面导航组件，包含logo区域与菜单区域

#### 属性说明
 - 无

#### 样例
```html
<@xy.nav/>
```





### container

------

#### 描述
内容部分，功能的具体内容都包含在该标签内。

#### 属性说明
 - type ： 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.container>
内容
</@xy.container>
```





## page_head
------

### 描述
页面标题区域

#### 属性说明
 - value:页面内容head部分的标题。
 - value_note:标题的说明。
 - more:true/false，默认为false，是否具有更多查询条件区域
 - type : 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.page_head value="参数配置" value_note="系统内控制参数配置">
    <@xy.text label="参数名称" value="${queryVo.likeItem['csmc']}" name="likeItem[csmc]" type="text" position="search" />
    <@xy.text label="参数标识" value="${queryVo.likeItem['csbs']}" name="likeItem[csbs]" type="text" position="search" />
    <@xy.select list=cslxMap label="参数类型" value="${queryVo.equalItem['cslx']}" name="equalItem[cslx]" headerValue="请选择..." position="search" />
    <@xy.button type="search" onclick="forward(this);" url="${url}" />
</@xy.page_head>
```





### page_head_more

------

#### 描述
更多查询条件用组件，与page_head组合使用

#### 属性说明
 - 无

#### 样例
```html
<@xy.page_head value="系统日志" value_note="系统日志运行过程所产生的日志" more=true>
    <@xy.text label="功能名称" value="${queryVo.likeItem['resname']}" name="likeItem[resname]" type="text" position="search" />
    <@xy.button type="search" onclick="forward(this);" url="${url}"/>
</@xy.page_head>
<@xy.page_head_more>
    <div class="row">
        <@xy.text label="IP地址" value="${queryVo.equalItem['ip']}" name="equalItem[ip]" type="text" position="search" />
    </div>
    <div class="row">
        <@xy.text label="操作" value="${queryVo.likeItem['opcontent']}" name="likeItem[opcontent]" type="text" position="search"/>
        <@xy.text label="备注" value="${queryVo.likeItem['beiz']}" name="likeItem[beiz]" type="text" position="search"/>
    </div>
</@xy.page_head_more>
```





### page_content

------

#### 描述
页面内容部分

#### 属性说明
 - type : 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.page_content>
内容
</@xy.page_content>
```




### content_title

------

#### 描述
页面内容的标题区域

#### 属性说明
 - value:标题内容
 - type : 定义页面类型,当为popup时为弹出页面
 - id : id属性
 - name ： name属性

#### 样例
```html
<@xy.content_title value="系统日志列表">
内容
</@xy.content_title>
```





### content_body

------

#### 描述
页面内容的标题区域

#### 属性说明
 - type : 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.content_body>
内容
</@xy.content_body>
```





### content_submit

------

#### 描述
编辑页面的提交按钮区域

#### 属性说明
 - type : 定义页面类型,当为popup时为弹出页面

#### 样例
```html
<@xy.content_submit>
    <@xy.button url="${base}/base/xtgl/xtgl/cspz/gg_cspz/saveGg_cspz" type="save" onclick="submitx(this,'cspzForm')"/>
    <@xy.button type="return" onclick="back('${base}/base/xtgl/xtgl/cspz')"/>
</@xy.content_submit>
```





### page_footer

------

#### 描述
页面底部组件，预留

#### 属性说明
 - 无

#### 样例
```html
<@xy.page_footer />
```





### foot_script

------

#### 描述
底部script标签，已经引入常用js，可引入页面特有js文件

#### 属性说明
 - 无

#### 样例
```html
<@xy.foot_script >
    <@xy.script src="base/xtgl/xtgl/cspz/CspzValidate.js"/><!—自定义js-->
</@xy.foot_script>
```







## 通用组件





### script

------

#### 描述
引入static工程下的通用js。

#### 属性说明
 - src：需要引入的js文件，目录从resources/开始

#### 样例
```html
<@xy.script src="js/bootstrap.min.js"/>
```





### scriptCurrent

------

#### 描述
引入当前工程下的js

#### 属性说明
 - src：需要引入的js文件，目录从resources/开始

#### 样例
```html
<@xy.scriptCurrent src="js/base/zzqx/zygl/cdgl/CdglValidate.js"/>
```




### css

------

#### 描述
引入ststic工程下的css

#### 属性说明
 - src：需要引入的css文件，目录从resources/开始

#### 样例
```html
<@xy.css href="css/plugins/chosen/chosen.css"/>
```





### cssCurrent

------

#### 描述
引入ststic工程下的css

#### 属性说明
 - src：需要引入的css文件，目录从resources/开始

#### 样例
```html
<@xy.cssCurrent href="js/plugins/zTree_v3-master/css/zTreeDiy.css"/> 
```





## 表单组件





### form

------

#### 描述
form表单区域，相当于html的<form>标签

#### 属性说明
 - method：默认为get
 - position：form出现的位置，search表示查询页面，edit表示编辑页面，none表示输出无样式form。
 - action：form的action
 - id：form的id

#### 样例
```html
<@xy.form>内容</@xy.form>
```





### searchButton
------

#### 描述
page-head中的搜索按钮

#### 属性说明
 - id：id
 - name：组件的name，并具有提交绑定值功能。

#### 样例
```html
<@xy.searchButton id="btn" name="searchBtn" /> 
```



### text
------

#### 描述
输入框组件，约等于html中的input标签

#### 属性说明
 - type:text文本框；password密码框；hidden隐藏域。
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - position：组件出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - label:标签名称  
 - labelid:对edit状态下前方的文字的装饰部分设置id
 - help:提示信息
 - bmbz:别名标志
 - bmkey:别名键值

#### 样例
```html
<@xy.text value=${core_user.name} name="name" type="password"/>
```





### textarea
------

#### 描述
多行文本框，等于html中textarea标签

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - position：组件出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - cols：列数
 - rows：行数，默认为3
 - label:标签名称  
 - labelid:对edit状态下前方的文字的装饰部分设置id
 - help:提示信息
 - bmbz:别名标志
 - bmkey:别名键值

#### 样例
```html
<@xy.textarea value=core_user.name name="name" />
```





### radio
------

#### 描述
单选按钮组，等于html中radio标签，value值会自动选中。

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - listKey:pojo中的属性，对应option中的显示值
 - listValue:pojo中的属性，对应option中的value
 - list:可以是map，可以是list<pojo>，如果是pojo的话，需要指定listValue和listKey的值，表示pojo对应的属性名。
 - position：组件出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - label:标签名称  
 - help:提示信息
 - bmbz:别名标志
 - bmkey:别名键值

#### 样例
 - Map形式
```html
<@xy.radio list=cityMap value=core_user.name name="username" />
```
 - list<pojo>形式
```html
<@xy.radio list=listAll listKey="id" listValue="name" name="username" value=core_user.name/>
```





### checkbox

------

#### 描述
复选框，等于html中checkbox标签，value值会自动选中。

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - listKey:pojo中的属性，对应option中的显示值
 - listName:pojo中的属性，对应option中的value
 - list:可以是map，可以是list<pojo>，如果是pojo的话，需要指定listValue和listKey的值，表示pojo对应的属性名。
 - position：组件出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - label:标签名称  
 - help:提示信息
 - bmbz:别名标志
 - bmkey:别名键值

#### 样例
 - Map形式
```html
<@xy.checkbox list=cityMap value=listValue name="listCheckbox" />
```
 - list<pojo>形式
```html
<@xy.checkbox list=listAll listKey="id" listValue="name" name="listCheckbox" value=listValue/>
```





### checkboxsingle
------

#### 描述
复选框，独立使用的checkbox，例如列表第一列。。

#### 属性说明
 - value:后台展示值，是一个数组。
 - id:id。
 - name:想后台提交绑定值，传到后台之后是数组形式，String[] listCheckbox，需自行转换。
 - checked:“true”,”false”

#### 样例
 - 略





### select
------

#### 描述
列表框，等于html中select标签，value值会自动选中。

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:想后台提交绑定值，如果是多选，传到后台之后是数组形式，String[] listCheckbox，需自行转换。
 - listKey:pojo中的属性，对应option中的value
 - listValue:pojo中的属性，对应option中的显示值
 - list:可以是map，可以是list<pojo>，如果是pojo的话，需要指定listValue和listKey的值，表示pojo对应的属性名。
 - headerKey：虚拟值，例如全部。
 - headerValue：虚拟显示值，例如全部。
 - multiple：是否多选，默认为下拉列表，当值为multiple为多选下拉列表。
    多选下拉框：

 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - label:见text组件说明
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息


#### 样例
 - Map形式
```html
<@xy.select list=cityMap value=jk_dxfsrz.username name="username" />
```
 - List<pojo>形式
```html
<@xy.select list=cityMap value=jk_dxfsrz.username name="username" />
```





### calendar
------

#### 描述
日期时间控件。

#### 属性说明
 - value:展示值。 
 - id:id。 
 - name:后台提交绑定值。 
 - time:是否显示小时、分钟，默认为true. 
 - second:是否显示秒，默认为false。 
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。 
 - required：是否必填，true/false，如果为true，则前面自动追加星号 
 - label:见text组件说明 
 - bmbz:别名标志 
 - bmkey:别名键值 
 - help:提示信息

#### 样例
```html
<@xy.calendar value=jk_dxfsrz.sendtime time="false" id="ccc" name="username"/>
```





### button
------

#### 描述
按钮，对应html中的button控件。

#### 属性说明
 - id:id。
 - name:name
 - type:按钮类型，按需选择，按钮类型会决定按钮样式和按钮名称，并不是html中input的type属性。
 - text:按钮名称，默认会根据type取得，需自定义的时候修改该属性。
 - parameters:形式为 {'id':'${gg_zm.id}'}
 - url：按钮需要提交到的地址，绝对路径
 - onclick:点击事件
 - ignoretrt：是否忽略trt校验，用于动态参数按钮，默认为false，当出现参数被篡改提示时，考虑是否需要增加该参数

#### 样例
```html
<@xy.button  type="edit_line" onclick="forward(this);" url="${ctx}/base/zzqx/zygl/zmgl/editGg_zm" parameters="{'id':'${gg_zm.id}'}"/>
```





### a
------

#### 描述
超链接，对应html中的a控件。非特殊情况请不要使用。

#### 属性说明
 - id:id。
 - name:name
 - text:超链接名称 
 - parameters:形式为 {'id':'${gg_zm.id}'}
 - url：超链接地址
 - onclick:点击事件

#### 样例
```html
<@xy.a type="none" text="流程图" onclick="forward(this);" url="${ctx}/wf/lcgl/lcpz/lcdy/chart" parameters="{'id':'${wf_lcdy.id}'}"/>
```





### button_more
------

#### 描述
列表中按钮更多情况的处理

#### 属性说明
 - 无

#### 样例
```html
<@xy.button_more>
    <li>
        <@xy.a type="none" text="流程图" onclick="forward(this);" url="${ctx}/wf/lcgl/lcpz/lcdy/chart" parameters="{'id':'${wf_lcdy.id}'}"/>
    </li>
    <li>
        <@xy.a type="none" text="检验" onclick="forward(this,{'openFn':popupNomal('流程校验')});" url="${ctx}/wf/lcgl/lcpz/lcdy/verify" parameters="{'id':'${wf_lcdy.id}'}"/>
    </li>
</@xy.button_more>
```





### button_group
------

#### 描述
前面是输入框，后面是按钮的组件

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - position：组件出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - label:标签名称
 - text:按钮显示值
 - onclick:按钮点击事件
 - parameters：参数
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
```html
<@xy.button_group label="执行人组织" value="" id="zxrzzmc" name="zxrzzmc" position="edit" placeholder="执行人组织" onclick="forward(this,{'openFn':popupSmall('选择执行人组织')});" url="${PublicPageHelper.JG_TREE}"/>
```





### search_group
------

#### 描述
前面是输入框，输入框内部有删除和选择的组件 

#### 属性说明
 - oncancelclick：点X时对应的js事件
 - style：该控件大多数时间需要自定义宽度width:200px。
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - onclick：点击后面搜索定义的事件
 - text：最后的文字
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
```html
<@xy.search_group oncancelclick="$('#dm').val('');"  id="dm" name="dm" style="width:320px"  position="search"   placeholder="数据字典名称" onclick="search_ztree('dmnrTree','dm','DMMC');" text="搜索"/> 
```





### switch
------

#### 描述
前面是输入框，输入框内部有删除和选择的组件 

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:想后台提交绑定值
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - label:见text组件说明
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
```html
<@xy.switch label="是否添加管理员" value=xzgly position="edit" id="xzgly" name="xzgly"/> 
```
页面的js中如下方式调用：
```js
var xzgly = document.querySelector("#" + SWITCH_PREFIX + "xzgly");
var switchXzgly = newSwitchery(xzgly);
下面是个性化onchange方法，有需要的情况下才需要重载
xzgly.onchange = function () {
    superChangeSwitch(xzgly);//这是公共的方法，请首先调用
    onchangeSwitch($("#xzgly").val());//个性化方法，需自己写
};
```





### ckeditor
------

#### 描述
富文本编辑框

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:想后台提交绑定值
 - label:见text组件说明
 - clowidth:自定义组件组件宽度，默认是[3,5,4]

#### 样例
```html
<@xy.ckeditor id="nr" name="nr" value=web_content.nr colwidth=[1,10,1]/> 
```





### code
------

#### 描述
代码选择组件

#### 属性说明
 - type:tree(默认)、select两种形式，tree为弹出窗口树形组件选择，select就是普通下拉列表框，type=”select”显示如下：

 - lbbs:代码类别表lbbs字段值
 - jgbh：可选，如果有机构个性化代码需求可用
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - label:见text组件说明
 - check:是否多选，true/false,如果为true,则为多选，默认为false,多选情况如下：

 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
 - type=”tree”样例
```html
<@xy.code type="select" label="组织分类" id="zzfl" name="zzfl" value=gg_zz.zzfl position="edit"   placeholder="组织分类" text="选择" lbbs="zzfl"/> 
```
 - check=”true”样例
```html
<@xy.code id="fwfls" name="fwfls" value=fwfls  position="search"  placeholder="采购类型" text="选择" 
lbbs="CGFL" check=true />
```
 - type=”select”样例
```html
<@xy.code id="fwfls" name="fwfls" value=fwfls  position="search"  placeholder="采购类型" text="选择" 
lbbs="CGFL" check=true />
```





### mulcode
------

#### 描述
多选code组件

#### 属性说明
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - source:value值，格式为list
 - lbbs:代码类别表lbbs字段值
 - jgbh：可选，如果有机构个性化代码需求可用
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
```html
<@xy.mulcode label="标段（包）分类代码" id="fldm" name="fldm" required=true position="edit" source=pmList lbbs='CGML'/>
```





### input_suggest
------

#### 描述
输入建议框，文本框为可人工录入，但又有下拉列表进行选择，例如评标地点选择时，可选可录的情景。

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - placeholder：文本框内的提示信息
 - label:  
 - bmbz:别名标志
 - bmkey:别名键值
 - help:提示信息

#### 样例
```html
<@xy.input_suggest label="参数分类" position="edit" placeholder="参数分类" class="form-control" id="test_data" name="lj" value=gg_pzcs.lj />
```
页面的js中如下方式调用：
```js
$("#test_data").bsSuggest({
             url: "${ctx}/base/xtgl/xtgl/cspz/csflAjax"
})
```
后台对应方法（注：该组件支持复杂格式，请参考js组件demo）：
```java
@RequestMapping(value = "/csflAjax")
    @ResponseBody
    public Map csflAjax(HttpServletRequest request) {
        Map csflMap = new HashMap();
        csflMap.put("value", this.cspzService.getCsfl());
        return csflMap;
    }
```
注：http://lzw.me/pages/demo/bootstrap-suggest-plugin/demo/    js组件样例





### customComponent
------

#### 描述
编辑页面使用的时候，如果没有组件，可用该组件构建 

#### 属性说明
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - label:见text组件说明

#### 样例
```html
无
```





### upload
------

#### 描述
文件上传组件

#### 属性说明
 - value:后台展示值。
 - id:id。
 - name:组件的name，并具有提交绑定值功能。
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - required：是否必填，true/false，如果为true，则前面自动追加星号
 - type:文件类型，file/img,如果为file，则上传的文件以文件名的形式展示，如果为img，上传的文件以图片形式展示
 - help:提示信息

#### 样例
```html
<@xy.upload label="上传头像" id="tx" name="tx" value=gg_ry.tx type="img" max_count="1" max_file_size="200mb" require=true/>
```





### download
------

#### 描述
文件下载组件

#### 属性说明
 - value:后台展示值。
 - id:id。
 - position：form出现的位置，search表示查询页面，edit表示编辑页面。
 - type:文件类型，file/img,如果为file，则上传的文件以文件名的形式展示，如果为img，上传的文件以图片形式展示
 - help:提示信息

#### 样例
```html
<@xy.download label="客户指定说明文件" id="khzdwj" value=khzdwj position="edit"/>
```





### extended_field
------

#### 描述
扩展字段展示组件

#### 属性说明
 - listName:包括扩展字段标签名称，展示形式（输入框，下拉框，日期，code）等信息
 - tableName:所有扩展字段value值
 - zdmcMap：当展示形式为下拉框时，存的是下拉框展示值，当展示形式为code时，值为lbbs和jgbh

#### 样例
```html
<@xy.extended_field listName=gg_kzzdList tableName=gg_dmnr zdmcMap=zdmcMap/>
```





### extended_validate_elements
------

#### 描述
设置扩展字段校验组件，写在页面加载之后

#### 属性说明
 - list:每个扩展字段定义的校验
 - validate:校验变量名称

#### 样例
```html
 <@xy.extended_validate_elements list=gg_kzzdList validate="validate"/>
```



## 展示组件





### splittoolbar
------

#### 描述
分页组件

#### 属性说明
 - 无

#### 样例
```html
<@xy.splittoolbar />
```





### insert
------

#### 描述
展示组件

#### 属性说明
 - value：展示的值。
 - type：map/text/calendar/code
 - list：当类型为map时，需要遍历的集合
 - label:见text组件说明
 - position:见text组件说明


#### 样例
 - Map
```html
<@xy.insert type="map" list=lclbMap value=wf_lcsl.LCLB/> 
```
 - Text
```html
<@xy.insert value=wf_lcsl.ZZMC/> 
```
Calendar
```html
<@xy.insert type="calendar" value=wf_lcsl.LCFQSJ/>
```





### index
------

#### 描述
列表中展示序号的组件

#### 属性说明
 - 无

#### 样例
```html
<#list listWf_role as wf_role>
	<tr>
	    <td align="center"><@xy.index wf_role_index/><!—注意命名规则--></td>
	    <td align="center"><@xy.insert value=wf_role.name/></td>
	</tr>
</#list>
```



## 扩展组件

### pageoffice

#### 描述

集成卓正的pageoffice 在线编辑office控件

#### 属性说明

- **fileGroupId** 文件组id

- **plugs**   可为空

  ​        获取书签的完整的url 如：http://localhost:8082/data/api/bookmark/demo/bookmark

  ​        注意获取书签的Controller的RequestMapping必须以api开头,返回值必须是         ReturnValue<List<Map<String,Object>>>
  
  ```java
  @RestController
  @RequestMapping("api/bookmark/demo")
  public class BookMarkDemoController extends BaseController {
      @RequestMapping(value = "/bookmark")
      public ReturnValue<List<Map<String,Object>>> getBookmark(HttpServletRequest request, Model model) {
          Map<String,Object> a1=new HashMap<>();
          a1.put("name","书签");
          a1.put("id","root");
          a1.put("open",true);
          a1.put("bs","ROOT");
          Map<String,Object> a2=new HashMap<>();
          a2.put("name","经办人填写");
          a2.put("pId","root");
          a2.put("id","jbr");
          a2.put("bs","JBRTX");
          Map<String,Object> a3=new HashMap<>();
          a3.put("name","项目名称");
          a3.put("id","111111");
          a3.put("pId","jbr");
          a3.put("bs","XMMC");
          Map<String,Object> a4=new HashMap<>();
          a4.put("name","代理机构填写");
          a4.put("id","dljg");
          a4.put("pId","root");
          a4.put("bs","DLJGTX");
          Map<String,Object> a5=new HashMap<>();
          a5.put("name","项目序号");
          a5.put("id","2222");
          a5.put("pId","dljg");
          a5.put("bs","XMXH");
          List<Map<String,Object>> list=new ArrayList<>();
          list.add(a1);
          list.add(a2);
          list.add(a3);
          list.add(a4);
          list.add(a5);
          ReturnValue<List<Map<String,Object>>> returnValue =ReturnValue.newSuccessInstance();
          returnValue.setData(list);
          return returnValue;
      }
  }
  ```
  
  ​        ztree展示  如：

```json
[{"name": "书签","id": "root","open": true,"bs":"ROOT"},{"pId": "root","id": "jbr","name": "经办人填写","bs": "JBRTX"},{"pId": "jbr","id": "111111","name": "项目名称","bs": "XMMC"},{"pId": "root","id": "dljg","name": "代理机构填写","bs": "DLJGTX"},{"pId": "dljg","id": "2222","name": "项目序号","bs": "XMXH"}]
```

- **model** edit or view   编辑模式或者查看模式  可为空 默认view   

- **label** 展示按钮的名称，默认是’打开文件‘

- **review**  审阅模式  'true ' or  'false' 仅支持word 可为空 默认false

- **accept_review** 是否接受审阅    'true ' or  'false' 仅支持word

- **acceptButtonName** 接受按钮名称  默认“定稿”

- **titlebar**  展示标题栏 'true'  or  'false' 可为空 默认true

- **menubar**   展示菜单栏 'true'  or  'false' 可为空 默认true

- **office_toolbar** 展示Office工具栏 'true'  or  'false' 可为空 默认true

- **width**     可为空 默认1200

- **height**    可为空 默认800

- **outline** 组件中a标签是否使用outline样式  'btn-outline' or '' 默认没有

- **buttonStyle** 组件中a标签展示按钮的样式 'btn-info'（按钮形式展示） or 'btn-action'(超链接形式展示) 默认'btn-info'

- **size**  数量  size=1 不展示

     ```html
     <div class="opentext"></div>
     和
     <div class="bt-group"></div>
     ```

     的样式

- **bookmark** 可为空 json 包括模板文档类型、获取书签值的变量(替换模板内容时使用，模板有po_书签)
           例： Map paramMap=new HashMap(); paramMap.put("mblx":"ZBWJ");paramMap.put("xm_zbxm_id":"w112212");
                bookmark=JSON.toJSONString(paramMap)
       
- **po_bookmarks** 是否po_书签（使用pageoofice替换书签时为true） true是 false否 默认false（在模板时定义）

- **repalcecounts** 同一个书签替换次数（pageoffice替换书签时使用）默认10

- **pdfFileGroupId** word转pdf后，存pdf的fileGroupId ，如果有值的话，展示转换pdf按钮

- **pdfButtonName** pdf转换按钮名称  默认‘保存为PDF’

- **htmlFileGroupId** word转html后，存html的fileGroupId ，如果有值的话，展示转换html按钮

- **htmlButtonName** html转换按钮名称  默认‘保存为HTML’

- **saveDataURL** 将书签的内容通过该地址，回调给业务系统，业务系统自己处理书签内容

     保存数据的完整的url 如：http://localhost:8082/data/api/pageoffice/data/saveData

     ```java
     /**
      *
      * @ClassName PageOfficeController
      * @Author zhouguofeng
      * @Date 2019/9/4 10:07
      **/
     @RestController
     @RequestMapping("api/pageoffice/data")
     public class PageOfficeSaveDataController extends BaseController {
     
         @RequestMapping("/saveData")
         public ReturnValue saveData(HttpServletRequest request, @RequestBody Map<String,Object> map){
             ReturnValue returnValue=  ReturnValue.newSuccessInstance("成功");
             Gson gson=new Gson();
             System.out.println(gson.toJson(map));
             return returnValue;
         }
     }
     //结果如  {"deptName":"技术"}
     ```

- **callbackFunction** 回调函数，调用使用pageoffice组件页面的js函数 如  abc

     注意：传函数名即可，保存成功后，会给该函数回传参数 word、pdf、html，通知回调函数哪个类型的文档保存成功

     ![image-20200718143958276](./assets/image-20200718143958276.png)

     ![image-20200718144051923](./assets/image-20200718144051923.png)

     ![image-20200718144144005](./assets/image-20200718144144005.png)

- **bookmark_authority** true or false 默认false 是否书签权限控制，根据当前登录人的id，控制每个人操作不同的书签 bookmark_authority=true时，model只能是model=edit，如果model=editbookmark，则所有人只能操作书签里面的内容

- **allowPrinting** 是否允许打印 控制打印按钮是否显示，需配合model='view'使用， 默认为 true，为false时，不展示打印按钮，禁止拷贝、禁止另存为、禁止打印、禁止打印预览

- **newReplaceBookmark** true or false  默认false 是否启用新的书签替换  新的书签替换包括文本(text_开头)，图片(image_开头),表格(table_开头),word文档(word_开头) ，老的书签替换只能替换文本

     表格demo：三行五列的表格，从第一行第一列到第三行第一列，合并为一个单元格

     ```java
     List<PageofficeTable_v.Mergecell_v> listMc = new ArrayList<>();
     listMc.add(new PageofficeTable_v.Mergecell_v(1, 1, 3, 1,"合并后的内容"));
     //组织表数据
     List<Object[]> listObj = new ArrayList<>();
     listObj.add(new Object[]{"11", "12", "13", "14", "15"});
     listObj.add(new Object[]{"21", "22", "23", "24", "25"});
     listObj.add(new Object[]{"31", "32", "33", "34", "35"});
     PageofficeTable_v pot = new PageofficeTable_v(3, 5, new String[]{"测试1", "测试2", "测试3", "测试4", "测试5"}, listObj, listMc);
     Bookmark_v b5 = new Bookmark_v();
     b5.setBookmarkName("TABLE_CRBG");
     Gson gson=new Gson();
     b5.setValue(gson.toJson(pot));
     ```

     ![image-20200718143845161](./assets/image-20200718143845161.png)

     图片、word文档：传fileGroupId

     ```java
     Bookmark_v b2 = new Bookmark_v();
     b2.setBookmarkName("IMAGE_XMMC");
     b2.setValue("5a0fa3cd6b19429aa0f6e90ff1cb6407");
     Bookmark_v b3 = new Bookmark_v();
     b3.setBookmarkName("WORD_CRDOC");
     b3.setValue("a1211ffdfe604631a8e78d4561fbe28e");
     ```

![image-20200718143805235](./assets/image-20200718143805235.png)

#### 样例

```html
<@xy.PageOffice label="打开文件" fileGroupId="${fileGroupId}" model="edit" menubar="true" custom_toolbar="false" office_toolbar="true" review="false" plugs='http://localhost:8082/data/api/bookmark/demo/bookmark'       saveDataURL="http://localhost:8082/data/api/pageoffice/data/saveData" callbackFunction="abc" pdfFileGroupId="${dpxx.pdfFileGroupId}" pdfButtonName="转换pdf" htmlFileGroupId="${dpxx.htmlFileGroupId}" htmlButtonName="转换html"/>
```

####  注意

需要在引用的项目中引用组件的扩展包

```xml
<dependency>
   <groupId>com.xinyuan</groupId>
   <artifactId>eps-pageoffice-support</artifactId>
</dependency>
```

需要在yml配置文件中增加pageoffice授权license.lic的配置路径        

```yml
eps
  support:
    extra:
      pageoffice-po-sys-path: e:\\
```

#### pageoffice版本问题

eps 2.2.0-SNAPSHOT已默认使用pageoffice 5.0.0.11版本

项目中使用pageoffice 5.0.0.11版本需要依赖

```yaml
<dependency>
    <groupId>com.xinyuan</groupId>
    <artifactId>eps-pageoffice-support</artifactId>
</dependency>
```

项目中使用pageoffice 4.5.0版本需要依赖

```yaml
<dependency>
    <groupId>com.xinyuan</groupId>
    <artifactId>eps-pageoffice-support</artifactId>
    <exclusions>
        <exclusion>
            <groupId>com.xinyuan.thirdparty.local</groupId>
            <artifactId>pageoffice</artifactId>
        </exclusion>
    </exclusions>
</dependency>
<dependency>
    <groupId>com.xinyuan.thirdparty.local</groupId>
    <artifactId>pageoffice</artifactId>
    <version>4.5.0</version>
</dependency>
```

### PO_Words2Pdfs

#### 描述

使用pageoffice控件，不展示word内容进行批量word转pdf，支持多个文件转化。

#### 属性说明

- **fileGroupIds**     格式为

  ```json
  [{'fileGroupId':'111','pdfFileGroupId':'1111'},{'fileGroupId':'222','pdfFileGroupId':'2222'}] 
  ```

   fileGroupId word的fileGroupId  

   pdfFileGroupId word转pdf后，存pdf的fileGroupId

- **width**     可为空 默认600

- **height**    可为空 默认300

- **callbackFunction** 回调函数，调用使用pageoffice组件页面的js函数 如  abc()

#### 样例

```html
<@xy.PO_Words2Pdfs label="文件转换"  fileGroupIds="[{'fileGroupId':'111','pdfFileGroupId':'1111'},{'fileGroupId':'222','pdfFileGroupId':'2222'}]"  callbackFunction="abc()"/>
```

#### 注意

需要在引用的项目中引用组件的扩展包

```xml
<dependency>
   <groupId>com.xinyuan</groupId>
   <artifactId>eps-pageoffice-support</artifactId>
</dependency>
```

需要在yml配置文件中增加pageoffice授权license.lic的配置路径        

```yml
eps
  support:
    extra:
      pageoffice-po-sys-path: e:\\
```

#### 



# 后台服务





## 控制器





### QueryVo
------

#### 页面绑定查询条件，不自定义sql语句情况 

##### 描述
QueryVo是页面查询对象封装类

##### 属性说明
 - 无

##### 样例
 - 绑定之后可用如下写法在页面上使用
```html
<@xy.text label="参数标识" value="${queryVo.likeItem['csbs']}" name="likeItem[csbs]" type="text" position="search" />
```
 - 后台可使用queryVo.generateAndSql()，自动构建形如”and csbs:=csbs”的sql语句，可传入参数true/false自动判断是否生成where语句
```java
sql = sql.append(queryVo.generateAndSql());
```
- 后台可使用queryVo.getQueryMap()，自动构建map.put(“csbs”,csbs)的Map供查询方法调用。
```java
List<Po> poListSplit =  selectSplit(sql.toString(), queryVo.getQueryMap(), splitPageInfo,new Po());
```
- QueryVo提供likeItem,equalItem,greaterItem,lessItem，unequalItem，分别对应数据库中like,=,>,<,!=操作符，可根据业务逻辑选择相应的Map容器。

#### 页面绑定查询条件，需要自定义后台某些查询条件情况

##### 描述
QueryVo是页面查询对象封装类

##### 属性说明
 - 无

##### 样例
 - 需要增加一个查询条件，会自动生成sql语句和map对象
```java
queryVo.addEqualItem("sfjsmb", Constants.NO);
```
 - 需要增加一段自定义sql语句，自定义map对象
```java
queryVo.appendExtSql("(jgbh=:djjgid or jgbh=:zzid)");
queryVo.addQueryMap("zzid", zzid);
```
- 需要增加order by语句
```java
queryVo.appendOrderBySql(" order by sxh");
```
***注：如果需要取得likeItem等map中的对象，请使用getEqualItemValue方法取得对应的值。***





### ReturnValue

------

#### 描述
 - ReturnValue是操作完成之后的返回值对象。
 - 操作成功时，可调用ReturnValue.newSuccessInstance()方法返回成功对象。
 - 后台校验未通过或者其他情况造成的页面跳转，调用ReturnValue.newCustomInstance()方法返回自定义对象。


#### 属性说明
 - 无

#### 样例
 - 无



### BaseController
------

#### 描述
1. 系统所有Controller类基类。
2. 目前有以下几类方法
  - 2.1 获取当前登陆人相关信息，包括Visit、单独的获取机构、部门方法
  - 2.2防止重复提交用的几个方法
3. 具体内容详见api


#### 属性说明
 - 无

#### 样例
 - 无



### Visit
------

#### 描述
 - 系统登录人员信息的封装类
 - 具体内容详见api


#### 属性说明
 - 无

#### 样例
 - 无



### XinyuanDefaultSplitPageInfo
------

#### 描述
 - XinyuanDefaultSplitPageInfo是系统的分页对象。
 - 调用setPageSize(int pageSize)方法可设定每页显示多少行。
 - 调用setSizeNum(int sizeNum)方法可设置每页显示多少页，规则为2*sizenum+1。

#### 属性说明
 - 无

#### 样例
 - 无





### ValidationUtil
------

#### 描述
后台校验类

#### 属性说明
 - 无

#### 样例
```java
Validations.ValidateResult result = ValidationUtil.validate(request, "static/js/wf/lcgl/lcpz/lcbl/BlstValidate.js"
```





## 服务





### BaseService
------

#### 描述
 - 系统提供的基础服务接口。
 - 继承该接口会获得BaseDao提供的所有方法。
 - 另外具备通用数据库操作方法，例如getMaxOrder、saveOrder等方法
 - 具体的方法参考对应类的api文档。

#### 属性说明
 - 无

#### 样例
 - 无





## 数据库访问





### BaseDao
------

#### 描述

- 系统提供的基础数据库访问类。
- 具体的方法参考对应类的api文档。

#### 属性说明

- 无

#### 样例

- 无





## 工具类





### TreeOp
------

#### 描述
 - 树操作辅助类，包括排序，获取顶级机构等方法。
 - 具体方法详见api文档。

#### 属性说明
 - 无

#### 样例
 - 无



### ZxtxxUtil
------

#### 描述
 - 子系统信息辅助类，用于获取子系统信息
 - 详见api文档。

#### 属性说明
 - 无

#### 样例
 - 无







## 远程调用


### 概述
------

#### 描述
 - helper是一组java类。
 - helper类提供了各种方法供调用，实质上是调用其他系统的某个方法。
 - 公司技术平台各子系统之间的访问通过且只通过helper进行。
 - helper的本质是resttemplate访问原系统提供的rest服务。

#### 属性说明
 - 无

#### 样例
 - 无





### CodeHelper
------

#### 描述

- 数据字典辅助类，查询数据字典相关方法均由此类提供。
- 详见api。

#### 属性说明

- 无

#### 样例

- 无





### XtglHelper
------

#### 描述

- 系统管理子系统提供的服务 。
- 详见api。

#### 属性说明

- 无

#### 样例

- 无





### ZzqxHelper
------

#### 描述

- 组织权限子系统提供的服务，组织机构、权限相关的服务由此服务提供 。
- 详见api。

#### 属性说明

- 无

#### 样例

- 无



### WorkFlowHelper
------

#### 描述

- 工作流子系统提供的服务。
- 详见api。

#### 属性说明

- 无

#### 样例

- 无





# javascript方法





## 页面提交



### forward
------

#### 描述
页面跳转用到的方法，如新增、修改时需弹出或替换页面。

#### 属性说明
 - obj 可以是button或者a的this，也可以使{action:''}

#### 样例

```html
<@xy.button  type="add" onclick="forward(this)" url="${ctx}/base/xtgl/rcgl/sjzd/addGg_dmlb" />

<@xy.button  type="add" text="js新增" onclick="turnWithJs()" />
<script type="text/javascript">
function turnWithJs(){
    forward({
      action:"${ctx}/base/xtgl/rcgl/sjzd/addGg_dmlb"
    })
}
</script>
```



### openWindow
------

#### 描述
弹出窗口的跳转方法

#### 属性说明
 - obj : 可以是button或者a的this，也可以使{action:''}
 - 弹出窗口的头部标题 : 1.button按钮上的text; 2.js中的title
#### 样例
```html
<@xy.button  type="sort" onclick="openWindow(this);"  url="/base/xtgl/rcgl/sjzd/sortGg_dmlb" text="排序"/>

<@xy.button  type="sort" text="js排序" onclick="openWithJs(this);" />
<script type="text/javascript">
    function openWithJs(){
        openWindow({
          title:"js排序",
          action:"/base/xtgl/rcgl/sjzd/sortGg_dmlb"
        })
      }
</script>
```



### hold
------

#### 描述
页面提交方法，用于编辑页面提交等


#### 属性说明
 - obj 可以是当前button对象，也可以是url
 - doneFn 回调函数
 - formid 想要提交的form表单id（可选）

#### 样例
```js
hold(obj, function(returnValue) {
    popupOk(returnValue, function () {              
        window.setTimeout(function () {
            back("${base}/base/xtgl/xtgl/cspz")
        }, staytime);
	},function(){
	    $("#" + formid).validate(validate).form()
	})
})
```





### ajaxdefault
------

#### 描述
通用的ajax提交方法。


#### 属性说明
 - 无

#### 样例
 - (url, parameters, doneFn)第一个参数是访问的地址，第二个参数是json，第三个参数是返回后调用的函数。
```js
ajaxDefault("${ctx}/base/xtgl/rcgl/jjrwh/saveGg_jjr", {"rq": rq}, function () {
    refresh();
});
```





### refresh
------

#### 描述
刷新当前页面。


#### 属性说明
 - 无

#### 样例
 - 参数为formid，可为空，为空时刷新第一个form。





## 弹出窗口





### popup
------

#### 描述
弹出窗口方法。


#### 属性说明
 - 无

#### 样例
```js
popup(title, shade, max, width, height) 
```





### popupNomal
------

#### 描述
弹出一个普通大小的弹出窗口。


#### 属性说明
 - 无

#### 样例
```js
popupNomal(title, shade)
```



### popupSmall
------

#### 描述
弹出一个小的弹出窗口，比如树形结构选择。


#### 属性说明
 - 无

#### 样例
```js
popupSmall(title, shade)
```





### popupOk
------

#### 描述
成功提示的弹出方法。

#### 属性说明
 - 第一个参数为返回值
 - 第二个参数为成功的回调函数
 - 第三个参数为失败后的回调函数。

#### 样例
```js
popupOk(returnValue, function () {
	 window.setTimeout(function () {back("${base}/base/xtgl/xtgl/cspz")}, staytime);
},function(){
    $("#" + formid).validate(validate).form()
});
```





### verify
------

#### 描述
弹出确认提交窗口，相当于浏览器中的confirm方法。

#### 属性说明
 - 第一个参数为提示信息内容.
 - 第二个参数为点确定之后的回调函数.

#### 样例
```js
verify("确定删除所选的信息吗？", function () {
    hold(obj, function (returnValue) {
        popupOk(returnValue, function () {
            window.setTimeout(function () {
               location.reload();
            }, staytime);
        });
    });
});
```





## 返回



### back
------

#### 描述
用于替换页面的返回，该方法会传递列表页面的查询条件，注意要一直传递QueryVo对象才可以保证查询条件的传递。

#### 属性说明
 - url : 网址
 - queryCriteria : 当为false时,返回到上一页,搜索头部将清空搜索条件

#### 样例
```js
back("${base}/base/xtgl/xtgl/cspz")

back("${base}/base/xtgl/xtgl/cspz",false)
```





# 校验框架



## 前台校验框架
------

### 描述

- 系统采用jQuery Validate作为前端校验框架。
- 教程：[jQuery Validate教程][1]
- 官网：[jQuery Validate官网][2]

### 规则

- required: 是否必填
- minlength: 最小长度
- maxlength:最大长度
- precision:精度，值为[14,2]，与数据库一致
- email：邮箱格式校验
- url:网址格式校验
- date:日期格式校验，校验格式为YYYY-MM-DD
- number:数字格式校验
- digits:校验只能为数字
- equalTo:判断输入是否相同
- creditcard:信用卡号码格式校验
- rangelength:判断输入字符串的长度范围
- range:判断输入数字的大小范围
- max:输入数字最大范围
- min:输入数字最小范围

### 样例

- 编写校验用js文件，放入指定位置

```js
var validate=
{
    rules: {
        csmc: {
            required: true,
            minlength: 2,
            maxlength:50
        }
    }
}
```

- 页面引入校验文件

```html
<@xy.script src="${base}/xtgl/xtgl/cspz/CspzValidate.js"/>
```

- 提交之前调用校验方法，该方法返回ture或者false

```js
$("#"+formid).validate(validate).form()
```





## 后台校验框架
------

### 描述

- 系统整合了jQuery Validate的js文件作为后台校验框架的校验文件。
- 在提交系统前调用校验方法，传入前台js校验文件的路径，如果校验失败需返回customInstance。
- 前台根据customInstance的内容进行相应的处理。

### 规则

- 无

### 样例

- 编写校验用js文件，放入指定位置

```js
Validations.ValidateResult result = ValidationUtil.validate(request, "resources/js/base/xtgl/xtgl/cspz/CspzValidate.js");
if (result.isValid()) {
    cspzService.save(gg_cspz);
    return ReturnValue.newSuccessInstance();
} else {
    //logger.info(ToStringBuilder.reflectionToString(result, ToStringStyle.MULTI_LINE_STYLE));
    return ReturnValue.newCustomInstance();
}
```





# 树形结构设计及操作





# 数据权限体系实现

------

## 1.描述

该章节描述列表权限体系控制，主要用于对于某一列表，不同人的查询条件不同情况处理。典型事例：项目列表经办人可看到自己项目，部门经理可看到部门项目，系统管理员可看到所有项目。

## 2.配置

### 2.1菜单管理——列表权限

设计开发阶段根据设计使用SearunMaster配置相应功能提供的数据权限接口实现。

### 2.2 角色模版管理

使用SearunMaster维护相关组织性质对应的数据权限的权限集合，该集合是相应组织性质管理员可以外下分配的数据权限的集合。

### 2.3 角色维护

组织的管理员使用角色维护功能，新增数据权限角色，维护角色对应的数据权限接口，分配给相关人员；也可通过组织机构管理、操作员管理给人员分配数据权限角色。

## 3.开发样例

#### 3.1 编辑规则（数据权限接口实现）

1.编写接口实现类实现`SqlPrivilegeGenerator`接口。该接口传入`Visit`和`QueryVo`两个对象，根据`visit`可组装需要的查询条件，使用`QueryVo`可组装查询条件与查询语句，注意`@Sevice`注解中请使用全路径，避免命名空间问题。例如

```java
@Service("com.xinyuan.dtxm.model.dtxm.tj.sltjt.Sltjt_bjgzPrivilegeGenerator")
public class Sltjt_bjgzPrivilegeGenerator implements SqlPrivilegeGenerator {
    @Override
    public QueryVo generateSqlPrivilegeObject(Visit visit, QueryVo queryVo) {
        List<String> jgbhList = new ArrayList<>();
        jgbhList.add(Constants_dtxm.GG_ZZ_BJ);
        jgbhList.add(Constants_dtxm.GG_ZZ_GZ);
        queryVo.appendExtSql("(select jgbh from xm_zbxm where id = xmxh) in (:jgbh)");
        queryVo.addQueryMap("jgbh", jgbhList);
        return queryVo;
    }
}
```

2.在系统菜单“组织权限->资源管理->菜单管理”中，找到需要配置列表权限的功能，点击最后面的“权限列表按钮”，新增一个权限，子系统编号为实现类所在子系统，脚本路径为刚才编写的`@Service`中的全路径。
3、在系统菜单“组织权限->权限管理->角色维护中”，新建角色，类别为“权限角色”，新建完成之后在列表后点击“列表权限”按钮，选择刚才新增的权限。
4、将该角色分给具有相关权限的人员。

#### 3.2 使用

**1.在controller注入**

```java
@Autowired
  private SqlPrivilegeService sqlPrivilegeService;

```

**2.mapping方法中应用**

```java
sqlPrivilegeService.generateSqlPrivilegeObject(request,this.getVisit(request),queryVo);
```



# 插件体系实现





# 重复提交
------

## 概述

- 系统采用token方式实现重复提交验证，在进入编辑页面的时候，生成一个token，在提交的时候将token提交到后台，一个token只能使用一次，如果前台发生多次提交，后台直接报token重复错误。

## 使用方式

- 在跳转向编辑页面的方法中生成token，样例如下

```java
prepareCheckResubmit(request);
```

- 在保存或者提交操作时

```java
if (checkResubmit(request)) {
    return ReturnValue.newResumbitInstance();
}
```





# crsf
------

## 概述

- 系统采用token方式实现防御crsf攻击，在页面头部放置自动生成的token，每次提交时带着该token，该token用户无法伪造，从而避免crsf攻击。

## 使用方式

- 正常情况下，只要在需要crsf的地方，只要使用的都是预定义的js方法，并传入QueryVo作为参数即可自动实现crsf。
- 如果在特殊地方发生crsf校验错误，例如ztree等js组件，自行封装了ajax请求，则需要手工构建crsf参数请求，例子如下：
- ztree

```js
async: {
	type: "post",
	enable: true,
	data: {zzmc: zzmc},
	url: "${ctx}/base/zzqx/zzjggl/zzjggl/pub/Gg_zzTreeSingleSelect/Gg_zzTreeAjax",
	autoParam: ["id", "name"],
	otherParam: ["_csrf", $('meta[name=_csrf]').attr('content')]
} 
```

- jqueryvalid

```js
data: {
	jslb: function () {
	    return $("#lbbs").val();
	},
	id: function () {
	    return $("#id").val();
	},
	_csrf: function () {
	    return $('meta[name=_csrf]').attr('content');
	}
}
```





# 参数防篡改
------

## 概述

- 主要用于点击修改、删除、查看按钮时通过修改参数达到访问非权限外页面的目的。

## 使用方式

- 在超链接带parameters参数时，后台会根据参数自动算出一个叫trt的值，后台会校验参数是否发生改变，以此防范参数被篡改。
- 如果参数是动态生成或者连接是动态生成，可使用ignoretrt=true来忽略篡改校验。